<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Liste des réclamations</h2>
    <button class="btn btn-primary" routerLink="/reclamations/add">
      <i class="bi bi-plus-circle me-1"></i> Nouvelle réclamation
    </button>
  </div>

  <div *ngIf="error" class="alert alert-danger">
    {{ error }}
  </div>

  <div *ngIf="loading" class="d-flex justify-content-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Chargement...</span>
    </div>
  </div>

  <div *ngIf="!loading && reclamations.length === 0" class="alert alert-info">
    Aucune réclamation trouvée.
  </div>

  <div class="table-responsive" *ngIf="!loading && reclamations.length > 0">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Titre</th>
          <th>Description</th>
          <th>Statut</th>
          <th>Priorité</th>
          <th>Date de création</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let reclamation of reclamations">
          <td>{{ reclamation.id }}</td>
          <td>{{ reclamation.titre }}</td>
          <td>
            {{ reclamation.description | slice : 0 : 50
            }}{{ reclamation.description.length > 50 ? "..." : "" }}
          </td>
          <td>
            <span
              class="badge"
              [ngClass]="{
                'bg-warning': reclamation.statut === 'EN_ATTENTE',
                'bg-success': reclamation.statut === 'TRAITEE',
                'bg-danger': reclamation.statut === 'REFUSEE',
                'bg-secondary': !reclamation.statut
              }"
            >
              {{ reclamation.statut }}
            </span>
          </td>
          <td>
            <span
              class="badge"
              [ngClass]="{
                'bg-success': reclamation.priorite === 'BASSE',
                'bg-warning': reclamation.priorite === 'MOYENNE',
                'bg-danger': reclamation.priorite === 'HAUTE'
              }"
            >
              {{ reclamation.priorite }}
            </span>
          </td>
          <td>{{ reclamation.dateCreation | date : "dd/MM/yyyy" }}</td>
          <td>
            <div class="btn-group">
              <button
                class="btn btn-sm btn-outline-primary me-1"
                [routerLink]="['/reclamations', reclamation.id]"
              >
                <i class="bi bi-eye"></i>
              </button>
              <button
                class="btn btn-sm btn-outline-success me-1"
                *ngIf="reclamation.statut === 'EN_ATTENTE'"
                (click)="changerStatut(reclamation.id!, 'TRAITEE')"
              >
                <i class="bi bi-check-circle"></i> Traiter
              </button>
              <button
                class="btn btn-sm btn-outline-danger me-1"
                *ngIf="reclamation.statut === 'EN_ATTENTE'"
                (click)="changerStatut(reclamation.id!, 'REFUSEE')"
              >
                <i class="bi bi-x-circle"></i> Refuser
              </button>
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="supprimerReclamation(reclamation.id!)"
              >
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
